<?xml version="1.0" encoding="utf-8"?>
<feed xml:lang="en-us" xmlns="http://www.w3.org/2005/Atom"><title>Tobi Personal Website</title><link href="https://oluwatobi.dev" rel="alternate"/><link href="http://oluwatobi.dev/" rel="self"/><id>https://oluwatobi.dev</id><updated>2023-10-11T16:00:00-05:00</updated><entry content="---&#10;share: True&#10;featured: True&#10;title: Fuzzy-Couscous - The CLI for a better django development experience&#10;slug: fuzzy_couscous_the_cli_for_a_better_django_development_experience&#10;tags:&#10; - python&#10; - django&#10; - projectstarter&#10; - cookiecutter&#10; - opensource&#10;description: &gt;&#10; A cli tool to bootstrap your django projects and enhance your development experience.&#10;publish_date: 2023-02-27&#10;upload_path: posts&#10;---&#10;&#10;Hello everyone!&#10;&#10;I'm excited to introduce you to [fuzzy-couscous](https://github.com/Tobi-De/fuzzy-couscous), my latest project designed to enhance your django development experience with Django.&#10;&#10;![showcase gif](https://raw.githubusercontent.com/Tobi-De/fuzzy-couscous/main/docs/assets/cuzzy_demo.gif)&#10;&#10;I've spent the last few months working on this command line tool, and I'm excited to share it with you and get your feedback.&#10;The primary feature of fuzzy-couscous is to generate a django project using a project template that I've built, inspired heavily by the popular [cookiecutter-django](https://github.com/cookiecutter/cookiecutter-django)&#10;project template. I simplified their template as much as I could while adding some of my favorite tools like [htmx](https://htmx.org/) and [poetry](https://python-poetry.org/).&#10;&#10;With fuzzy-couscous, you can quickly create a new Django project using the built-in template, which includes support for either [Bootstrap](https://getbootstrap.com/) or [Tailwind](https://tailwindcss.com/).&#10;It also comes with a variety of convenient commands, such as launching multiple processes at once including the Django dev server, a Redis server, a worker process, and more (although I'm currently working on improving this feature),&#10;as well as a command to easily download the latest version of htmx. I have some exciting ideas for potential new commands, including one to generate [CRUD](https://en.wikipedia.org/wiki/Create,_read,_update_and_delete) code ([#27](https://github.com/Tobi-De/fuzzy-couscous/issues/27))  and another to ensure that projects&#10;created with fuzzy-couscous can easily get updates from the base template ([#22]( https://github.com/Tobi-De/fuzzy-couscous/issues/22)).&#10;I'm always looking for new ideas and suggestions, so please feel free to open a [GitHub discussion](https://github.com/Tobi-De/fuzzy-couscous/discussions) or an [issue](https://github.com/Tobi-De/fuzzy-couscous/issues/new).&#10;&#10;This project is nothing revolutionary, but it's useful for me and I think it could be useful for other django developers out there.&#10;If you're interested, you can find fuzzy-couscous on GitHub at https://github.com/Tobi-De/fuzzy-couscous.&#10;I hope you'll give it a try and let me know what you think. Thanks for your time!&#10;"><title>Fuzzy-Couscous - The CLI for a better django development experience</title><link href="https://oluwatobi.dev/blog/fuzzy_couscous_the_cli_for_a_better_django_development_experience" rel="alternate"/><published>2023-02-27T16:00:00-06:00</published><id>https://oluwatobi.dev/blog/fuzzy_couscous_the_cli_for_a_better_django_development_experience</id><summary type="html">A cli tool to bootstrap your django projects and enhance your development experience.</summary></entry><entry content="---&#10;share: true&#10;featured: true&#10;title: Exploring SSE and PostgreSQL for Real-time Communication in Django&#10;slug: exploring_sse_and_postgresql_for_realtime_communication_in_django&#10;tags:&#10;  - python&#10;  - django&#10;  - sse&#10;  - postgresql&#10;  - starlette&#10;description: Discover how we improved our Django project's realtime notification system by leveraging Server-Sent Events (SSE) and PostgreSQL LISTEN/NOTIFY.&#10;publish_date: 2023-09-16&#10;upload_path: /&#10;---&#10;&#10;&gt;**TL;DR**: In this article, I explore how we built a relay system to serve real-time notifications to our Django project using Server-Sent Events (SSE) and PostgreSQL LISTEN/NOTIFY. Check out the final project on GitHub [here](https://github.com/Tobi-De/sse_relay_server). 🚀&#10;&#10;![sse relay transmission diagram](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b6esukxv1aw2io3jbr7p.png)&#10;&#10;Recently, at my workplace, I was tasked with creating a real-time notification system for one of our Django projects. I opted for [Server-Sent Events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events) (SSE). Luckily for me, around that time Django 4.2 introduced async iterators support for StreamingHttpResponse, which seemed ideal. However, as I delved deeper into the project, I decided instead to build a relay service using [Starlette](https://github.com/Tobi-De/sse_server_postgres_listen_notify) which transmits messages received through the PostgreSQL LISTEN/NOTIFY protocol to client browsers connected via SSE.&#10;&#10;It all began with an excellent post on [Writing a chat application in Django 4.2 using async StreamingHttpResponse, Server-Sent Events, and PostgreSQL LISTEN/NOTIFY](https://valberg.dk/django-sse-postgresql-listen-notify.html). I read the post and successfully applied the concepts. This wasn't my first encounter with the PostgreSQL LISTEN/NOTIFY protocol; I knew that tools like Procrastinate (a Python task queue) also used it. This protocol was appealing because it eliminated the need to introduce additional infrastructure like Redis into our setup since we were already using PostgreSQL as our database. In the end, what I did added an extra service to our setup, but I think it was worth it, even just for the idea it sparked.&#10;&#10;Initially, the setup worked seamlessly. Notifications were correctly transmitted and received. We switched from using Gunicorn to Daphne to run the project, and everything seemed fine. However, after a while, a colleague noticed that our server was constantly receiving requests on our SSE async view. It turned out that the connection was consistently disrupted, causing the browser to repeatedly attempt reconnection. This ultimately led to our PostgreSQL database sporadically crashing with an error message stating &quot;too many clients.&quot;&#10;&#10;At this point, we did something that, now that I think of it, makes absolutely no sense. We split our Django server into two instances: one running in WSGI mode with Gunicorn, and the other under Daphne in ASGI mode. It did not resolve the issue, maybe we did that thinking it would mitigate the issue. Who knows. However, it did provide me with an idea – replacing the Django app running under Daphne with something better suited for asynchronous operations.&#10;&#10;I ended up creating a relay using [Starlette](https://www.starlette.io), which transmitted messages received through the PostgreSQL [LISTEN](https://www.postgresql.org/docs/current/sql-listen.html)/[NOTIFY](https://www.postgresql.org/docs/15/sql-notify.html) protocol to client browsers connected via SSE (The diagram above). This solution proved to be more stable and reliable than the Django approach. Furthermore, it allowed me to simplify the original Django project by completely removing the ASGI setup and code from the project. I was not very fond of the idea of mixing and matching sync and asynchronous code anyway, so this was a win for me. For a straightforward communication method via SSE in Django, this approach worked pretty well.&#10;&#10;I've noticed several repositories on GitHub exploring similar ideas. I'm curious about its long-term viability 🤔, but for now, it works pretty well with our setup. After all, we only need the async stuff for real-time notifications. It was not worth turning our entire project into ASGI just for that. Plus, we can easily use the relay for some other precise and simple stuff in the project like updating charts, etc.&#10;&#10;Thanks for reading! I've turned the relay project into a package and a Docker image; you can check it out at [https://github.com/Tobi-De/sse_relay_server](https://github.com/Tobi-De/sse_relay_server).&#10;"><title>Exploring SSE and PostgreSQL for Real-time Communication in Django</title><link href="https://oluwatobi.dev/blog/exploring_sse_and_postgresql_for_realtime_communication_in_django" rel="alternate"/><published>2023-09-16T16:00:00-05:00</published><id>https://oluwatobi.dev/blog/exploring_sse_and_postgresql_for_realtime_communication_in_django</id><summary type="html">Discover how we improved our Django project's realtime notification system by leveraging Server-Sent Events (SSE) and PostgreSQL LISTEN/NOTIFY.</summary></entry><entry content="---&#10;share: true&#10;featured: true&#10;title: &gt;&#10;   Maximizing Productivity: PyCharm and htmx Integration&#10;slug: maximizing-productivity-pycharm-and-htmx-integration&#10;tags:&#10; - django&#10; - htmx&#10; - pycharm&#10;description: Throughout this quick guide, we will see how to add htmx support (documentation and autocompletion) in pycharm.&#10;publish_date: 2022-11-05&#10;upload_path: posts&#10;---&#10;&#10;&gt; **TL;DR** Learn how to add support for htmx in PyCharm for seamless development using [web-types](https://github.com/JetBrains/web-types#web-types).&#10;&#10;If you're not familiar with htmx, check out this fantastic [htmx + Django introduction](https://www.youtube.com/watch?v=Ula0c_rZ6gk) by [BugBytes](https://www.bugbytes.io/).&#10;&#10;### Introduction&#10;&#10;[htmx](https://htmx.org/) is my go-to frontend tool for building web applications, and [PyCharm from JetBrains](https://www.jetbrains.com/pycharm/) is my daily code editor/IDE. Unfortunately, by default, PyCharm doesn't recognize htmx attributes when used in templates, resulting in ugly warning lines 🙁.  This article will guide you on how to resolve this issue and improve your development workflow.&#10;&#10;### The Fix&#10;&#10;There's a simple way to add autocompletion and documentation for htmx attributes in JetBrains editors using [web-types](https://github.com/JetBrains/web-types#web-types). Web-types is a JSON-based format that provides IDEs with metadata information about web component libraries like htmx. I stumbled upon this tip via [this tweet](https://twitter.com/sponsfreixes/status/1573725414643535872), so kudos to the author for sharing it!&#10;&#10;### Step-by-Step Guide&#10;&#10; - **Create a `package.json` File**&#10;&#10;   Start by creating a `package.json` file, the central configuration file for Node.js-based applications. Although we're not building a Node.js package, this is the method to reference web-types in your PyCharm project. Ensure you have Node.js installed on your computer. If not, I recommend using [nvm](https://github.com/nvm-sh/nvm) to install it. After installing Node.js, you can use `npm` (included with all Node.js installations) to initialize a Node.js project and generate the `package.json` file.&#10;&#10;   ```sh&#10;   npm init -y&#10;   ```&#10;&#10;- **Create `htmx.web-types.json` File**&#10;&#10;   Create a new file named `htmx.web-types.json` and copy the htmx [web-types source](https://github.com/bigskysoftware/htmx/blob/master/editors/jetbrains/htmx.web-types.json) into it:&#10;&#10;   ```sh&#10;   touch htmx.web-types.json&#10;   ```&#10;&#10;- **Update `package.json`**&#10;&#10;   Add a new entry to your `package.json` with &quot;web-types&quot; as the key and the path to your `htmx.web-types.json` file as the value. Here's an example:&#10;&#10;   ```json&#10;   {&#10;     &quot;web-types&quot;: &quot;./htmx.web-types.json&quot;&#10;   }&#10;   ```&#10;&#10;- **Enjoy Autocompletion and Documentation**&#10;&#10;   Now, in your HTML templates, type an htmx attribute like `hx-get`, and you should see autocompletion and documentation directly accessible in your IDE. Cool, right? 😎&#10;&#10;### Conclusion&#10;&#10;With this simple setup, you can enhance your PyCharm experience and work seamlessly with htmx attributes in your Django projects. Happy coding!&#10;"><title>Maximizing Productivity: PyCharm and htmx Integration</title><link href="https://oluwatobi.dev/blog/maximizing-productivity-pycharm-and-htmx-integration" rel="alternate"/><published>2022-11-05T16:00:00-05:00</published><id>https://oluwatobi.dev/blog/maximizing-productivity-pycharm-and-htmx-integration</id><summary type="html">Throughout this quick guide, we will see how to add htmx support (documentation and autocompletion) in pycharm.</summary></entry><entry content="---&#10;share: true&#10;title: Easy database and migrations reset during development&#10;slug: easy-database-and-migrations-reset-during-development&#10;tags:&#10; - django&#10; - python&#10;description: Remove all your django migrations files with one commmand.&#10;publish_date: 2022-10-30&#10;upload_path: snippets&#10;---&#10;&#10;```sh&#10;touch rm_migrations.py&#10;```&#10;&#10;Copy the code below to your newly created `rm_migrations.py`&#10;&#10;```python&#10;from pathlib import Path&#10;&#10;&#10;def main():&#10;    apps_dir = Path() / &quot;django_apps&quot;&#10;    excludes = [&quot;__init__.py&quot;]&#10;    apps = set()&#10;    for folder in apps_dir.iterdir():&#10;        migration_dir = folder / &quot;migrations&quot;&#10;        if not migration_dir.exists():&#10;            continue&#10;        for file in migration_dir.iterdir():&#10;            if file.suffix == &quot;.py&quot; and file.name not in excludes:&#10;                file.unlink()&#10;                apps.add(str(folder))&#10;                print(f&quot;{str(file)} deleted&quot;)&#10;    res = &quot;\n&quot;.join(apps)&#10;    print(f&quot;\nRemoved migration files for apps: \n{res}&quot;)&#10;&#10;&#10;if __name__ == &quot;__main__&quot;:&#10;    main()&#10;```&#10;&#10;Don't forget to update `django_apps` in the script to the folder where your django applications are placed. The value you put should be a string representing the path of your django applications folder relative to the folder where the script is placed. I suggest placing the script in the root of your project.&#10;&#10;An example:&#10;&#10;```shell&#10;├── my_projects&#10;│   ├── my_apps&#10;│   ├── manage.py&#10;│   ├── rm_migrations.py&#10;```&#10;&#10;With the setup describe above, you need to replace `django_apps` by `my_apps`.&#10;&#10;**Never push this file to production**, accident happens, but you don't want them to happen on your production code / data.&#10;Add this line to your`.gitignore` file:&#10;&#10;```text&#10;rm_migrations.py&#10;```&#10;&#10;Run the script with:&#10;&#10;```shell&#10;python rm_migrations.py&#10;```&#10;&#10;In the development phase, when the project idea is not fully formed or the product requirements are continually changing, it is common to completely rewrite or modify (in a non-migratable way) your django models, which requires cleaning up and recreating all your migration files. If your project consists of more than a few applications, deleting the files by hand is quite annoying.&#10;With the above script, you can easily in one command delete all your migration files 😎.&#10;&#10;To reset my database (drop and recreate) I use the command below provided by the [django-extensions](https://django-extensions.readthedocs.io/en/latest/reset_db.html) package.&#10;&#10;```sh&#10;python manage.py reset_db --noinput&#10;```&#10;"><title>Easy database and migrations reset during development</title><link href="https://oluwatobi.dev/blog/easy-database-and-migrations-reset-during-development" rel="alternate"/><published>2022-10-30T16:00:00-05:00</published><id>https://oluwatobi.dev/blog/easy-database-and-migrations-reset-during-development</id><summary type="html">Remove all your django migrations files with one commmand.</summary></entry><entry content="---&#10;share: true&#10;featured: true&#10;title: A comprehensive guide to  multi-timezone support in Django&#10;slug: a_comprehensive_guide_to__multi-timezone_support_in_django&#10;tags:&#10;  - python&#10;  - django&#10;  - timezone&#10;description: &gt;&#10; Discover how to seamlessly manage timezones in Django and empower your applications with user-centric solutions.&#10; This article is your essential guide to precise and efficient multi-timezone support.&#10;publish_date: 2023-10-11&#10;upload_path: posts&#10;---&#10;&#10;&gt; **TL;DR**: To support multiple timezones in your Django project, you need a way to request your users' specific timezones and create a middleware that uses `django.timezone.activate(user_tz)` to enable a specific timezone for a user globally on your site. This ensures that every use of `django.timezone.now()` uses the activated timezone. If you prefer reading code directly, see [middleware.py](https://github.com/Tobi-De/leerming/blob/main/leerming/profiles/middleware.py) and [models.py](https://github.com/Tobi-De/leerming/blob/main/leerming/profiles/models.py).&#10;&#10;Throughout this article, I'll guide you on setting up multi-timezone support in a Django project. This post is aimed at beginners (assuming basic Django knowledge) and intermediates. If what I'm writing seems blatantly obvious to you, you're likely not in one of these categories, so please bear with us.&#10;&#10;### Introduction&#10;&#10;Time is universally a challenging subject to deal with, especially in software engineering. Handling time zones correctly is hard. Luckily for us, when working with Django, a significant portion of the work has already been done.&#10;&#10;For the longest time (literally until yesterday), I thought that the piece of code below was enough to have timezones fully managed and working in Django:&#10;&#10;```python&#10;# settings.py&#10;TIME_ZONE = &quot;UTC&quot;  # Sometimes, I'd switch this to my primary audience's timezone.&#10;USE_TZ = True&#10;```&#10;&#10;It turns out I was wrong, or at least I was missing the full picture. There's a bit more work left if you want to consider every user's timezone. Let's explore what's left to do.&#10;&#10;&gt; **Note** The official [Django documentation on timezones](https://docs.djangoproject.com/en/4.2/topics/i18n/timezones/) is very well written, so I highly suggest you read it. However, this article will provide you with the essentials, at least that's what I hope.&#10;&#10;### The Basics&#10;&#10;First, let's start with the basics. In Python, there are two types of datetime objects: naive and aware. We'll keep it simple. Naive datetime objects hold no timezone information, while aware datetimes hold timezone information.&#10;&#10;When you have the `USE_TZ` setting set to `True` in your project settings (as shown in the snippet above), Django will ensure that all the DateTime objects you create are timezone-aware. This is, of course, assuming that you use Django's timezone module to create your dates.&#10;&#10;```python&#10;from django.utils import timezone&#10;&#10;now = timezone.now()&#10;```&#10;&#10;This works if you're not concerned about user-specific timezones, and you're not doing anything fancy with datetime. But what if you are?&#10;&#10;### The Challenge&#10;&#10;Let me paint a picture: I'm building an app where I need to send daily notifications to users at specific times. My project's timezone is set to `UTC` – the recommended practice by most of the Django community. Here's the twist: I live in a UTC+1 timezone, and I realized my notifications were coming in an hour late. My cousin, who lives in Europe at a different timezone, also uses my app. Changing the default timezone wasn't an option. My cousin and I, along with potentially many other users, needed to navigate the app seamlessly without time feeling off. Scheduling and time management are at the core of my app, and I couldn't afford to mess that up.&#10;So, I decided to dive deep into understanding how Django deals with time zones – something I'd never made a priority before.&#10;&#10;After reading and re-reading the Django documentation, things started to click. First, let's grasp the fundamentals and then dive into setting up our timezone magic.&#10;&#10;There are two important concepts that Django uses: the &quot;default time zone&quot; and the &quot;current time zone.&quot;&#10;&#10;- The **default time zone** is the timezone you set in your Django settings via `TIME_ZONE`.&#10;- The **current time zone** is the timezone used for rendering. It's the one in which your users will browse your site.&#10;&#10;The `current time zone` defaults to the `default time zone` unless you **activate** the user's specific timezone using `django.utils.timezone.activate`.&#10;&#10;Does it start to make sense?&#10;Django, by default, doesn't know a user's timezone. It's not typically available in request data, so it sticks with the default timezone. You need to ask your users for their time zone – a simple form does the trick – and then manually activate it. The easiest and probably the best way to do this is through a middleware.&#10;&#10;### Setting Up Multi-Timezone Support&#10;&#10;Now, let's dive into a simple example. We'll create a user `Profile` model to collect and store each user's timezone. For simplicity's sake, I'll leave out the non-essential parts of the code.&#10;&#10;Here's a model for our users' profiles:&#10;&#10;```python&#10;import zoneinfo&#10;&#10;TIMEZONES_CHOICES = [(tz, tz) for tz in zoneinfo.available_timezones()]&#10;&#10;class Profile(TimeStampedModel):&#10;    user = models.OneToOneField(&#10;        &quot;users.User&quot;, related_name=&quot;profile&quot;, on_delete=models.CASCADE&#10;    )&#10;    timezone = models.CharField(&#10;        verbose_name=_(&quot;Fuseau horaire&quot;),&#10;        max_length=50,&#10;        default=&quot;UTC&quot;,&#10;        choices=TIMEZONES_CHOICES,&#10;    )&#10;```&#10;&#10;With the model above, we have a simple `CharField` to hold the user's timezone and a choices field to render a select using a Django form. You can customize the list of available timezones obtained from the `zoneinfo module`. For a simpler user experience, you might choose to filter it by continent or display the city as the label.&#10;&#10;&gt; Tip: If you're displaying a long list of timezones, consider using a select element with a search feature(e.g, [tom-select](https://github.com/orchidjs/tom-select)) for a better user experience.&#10;&#10;You'll need to create a form and a view to set the timezone value – standard Django stuff.&#10;&#10;Now, let's create the middleware to activate the user's timezone:&#10;&#10;```python&#10;import zoneinfo&#10;&#10;from django.utils import timezone&#10;&#10;from .models import Profile&#10;&#10;&#10;class TimezoneMiddleware:&#10;    def __init__(self, get_response):&#10;        self.get_response = get_response&#10;&#10;    def __call__(self, request):&#10;        if request.user.is_authenticated:&#10;            try:&#10;                profile = request.user.profile&#10;            except Profile.DoesNotExist:&#10;                timezone.deactivate()&#10;            else:&#10;                timezone.activate(zoneinfo.ZoneInfo(profile.timezone))&#10;        else:&#10;            timezone.deactivate()&#10;        return self.get_response(request)&#10;```&#10;&#10;This middleware activates the user's timezone if they're authenticated and have a profile. In other cases, we call `deactivate`, which sets the timezone to the default. While this last step is not strictly required, that's how the Django docs suggest doing it, so let's stick with that. To complete the setup, don't forget to register your middleware in your settings within the `MIDDLEWARE` list.&#10;&#10;```python&#10;MIDDLEWARE = [&#10;     ...&#10;    &quot;your_app.middleware.TimezoneMiddleware&quot;,&#10;]&#10;```&#10;&#10;With this setup, we've made sure that every call to `timezone.now` will takes the user's specific timezone into account. When datetime objects are saved to the database, they are automatically converted to UTC. For example, in my case (UTC+1), if I input &quot;6:00 pm&quot; on the UI to record a time, it will be saved in the database as `5:00 pm` (though it will still be rendered as &quot;6:00 pm&quot; to me on the frontend).&#10;&#10;### Quick Tips and bits:&#10;&#10;If you need to create a timezone-aware datetime object manually, for example by combining a date and time, here's how you do it:&#10;&#10;```python&#10;import datetime as dt&#10;&#10;naive_datetime = dt.datetime.combine(my_date, my_time)&#10;aware_datetime = timezone.make_aware(naive_datetime, zoneinfo.ZoneInfo(user_timezone))&#10;```&#10;&#10;The code below will generate a new migration every time you run `python manage.py makemigrations`:&#10;&#10;```python&#10;TIMEZONES_CHOICES = [(tz, tz) for tz in zoneinfo.available_timezones()]&#10;&#10;class Profile(models.Model):&#10;  timezone = models.CharField(&#10;          verbose_name=_(&quot;Fuseau horaire&quot;),&#10;          max_length=50,&#10;          default=&quot;UTC&quot;,&#10;          choices=TIMEZONES_CHOICES,&#10;      )&#10;```&#10;&#10;The culprit line is `choices=TIMEZONES_CHOICES`. A simple fix is to update the migrations file to use the  `TIMEZONES_CHOICES` constant directly:&#10;&#10;```python&#10;class Migration(migrations.Migration):&#10;    ...&#10;&#10;    operations = [&#10;        ...&#10;        migrations.AddField(&#10;            model_name=&quot;profile&quot;,&#10;            name=&quot;timezone&quot;,&#10;            field=models.CharField(&#10;                choices=TIMEZONES_CHOICES,&#10;                default=&quot;UTC&quot;,&#10;                max_length=50,&#10;            ),&#10;        ),&#10;    ]&#10;```&#10;&#10;&#10;### Conclusion&#10;&#10;There you have it! Your Django app is now fully equipped to support multiple timezones.&#10;I hope this article adds a touch of timezone magic to your Django projects.&#10;Thanks for the read.&#10;"><title>A comprehensive guide to  multi-timezone support in Django</title><link href="https://oluwatobi.dev/blog/a-comprehensive-guide-to-multi-timezone-support-in-django" rel="alternate"/><published>2023-10-11T16:00:00-05:00</published><id>https://oluwatobi.dev/blog/a-comprehensive-guide-to-multi-timezone-support-in-django</id><summary type="html">Discover how to seamlessly manage timezones in Django and empower your applications with user-centric solutions.
This article is your essential guide to precise and efficient multi-timezone support.</summary></entry><entry content="---&#10;share: True&#10;featured: False&#10;title: Bootstraping a production-ready django project&#10;slug: bootstraping-a-production-ready-django-project&#10;tags:&#10; - python&#10; - django&#10; - cookiecutter&#10; - project-template&#10;description: &gt;&#10; If you have some experience with django and feel that the django django-admin startproject command is too light for you, then cookiecuter-django might be just what you are looking for.&#10;publish_date: 2022-10-30&#10;upload_path: posts&#10;---&#10;&#10;Through this guide, we will see how to start a new django project using a [cookiecutter](https://github.com/cookiecutter/cookiecutter). This guide is intended for beginners and intermediate level devs who already have experience with django and want a ready to use production grade setup for their django projects.&#10;I'm promoting [cookiecutter-django](https://github.com/pydanny/cookiecutter-django) here, but it's not the only one available in town, a quick search for django cookiecutter on the [django packages](https://djangopackages.org/grids/g/cookiecutters/) website or [GitHub](https://github.com/search?q=django+cookiecutter) will give you a ton of options.&#10;&#10;If you are wondering what I mean by **production-ready**, here is a non-exhaustive list of what I expect :&#10;&#10;- settings oriented towards the highest level of security&#10;- basic deployment requirements included&#10;- logging and monitoring set up&#10;- postgresql requirements included&#10;- linters and formatters already set up&#10;- pytest set up&#10;- etc&#10;&#10;And for convenience, **cookiecutter-django** makes it easy to set up via the prompt common django packages that solve common issues such as :&#10;&#10;- Task queue manager (celery)&#10;- Mail services (amazon SES, Sendgrid, etc.) etc.&#10;- CI / CD pipeline (GitHub, gitlab, etc)&#10;&#10;If you are already convinced at this point, just run the two commands below, and you are done 😀.&#10;&#10;```sh&#10;pip install &quot;cookiecutter&gt;=1.7.0&quot;&#10;cookiecutter https://github.com/cookiecutter/cookiecutter-django&#10;```&#10;&#10;Read on for a closer look at all the options available and why you might want to ignore some of them to simplify the initial project generated a bit.&#10;&#10;## So what is a cookiecutter anyway ?&#10;&#10;The [cookiecutter](https://github.com/cookiecutter/cookiecutter) project was initiated by [Audrey Feldroy](https://github.com/audreyfeldroy), the co-author of the excellent [Two Scoops of Django](https://www.feldroy.com/collections/everything/products/two-scoops-of-django-3-x).  It is a command-line utility that creates projects from cookiecutters (project templates). There are a multitude of cookiecutters for various frameworks, django, flask, etc.&#10;&#10;## Generate a project using cookiecutter-django&#10;&#10;The default values are in brackets, if you see a blank line, then I used the default value by pressing the **Enter** key. Throughout the article I have included many links to other articles to help understand what I can't go into here, but don't feel obligated to follow each link every time, or you may never get through it 😅. I suggest you read the entire article at least once, then revisit it by following the links that interest you.&#10;&#10;### Installation&#10;&#10;```sh&#10;pip install &quot;cookiecutter&gt;=1.7.0&quot;&#10;cookiecutter https://github.com/cookiecutter/cookiecutter-django&#10;```&#10;&#10;### Project metadata&#10;&#10;This section is for basic project information such as name, description, authors, etc.&#10;&#10;```shell&#10;project_name [My Awesome Project]: Ushopify&#10;project_slug [ushopify]:&#10;description [Behold My Awesome Project!]: My amazing ecommerce platform.&#10;author_name [Daniel Roy Greenfeld]: John Doe&#10;domain_name [example.com]: ushopify.com&#10;email [john-doe@example.com]: doe@ushopify.com&#10;version [0.1.0]:&#10;Select open_source_license:&#10;1 - MIT&#10;2 - BSD&#10;3 - GPLv3&#10;4 - Apache Software License 2.0&#10;5 - Not open source&#10;Choose from 1, 2, 3, 4, 5 [1]: 1&#10;```&#10;&#10;A source code license is a legal text that tells people what they may do with the source code, for example, edit it, use it, share it with others freely, etc. More information about software licensing [here](https://en.wikipedia.org/wiki/Software_license).&#10;&#10;```shell&#10;timezone [UTC]: US/Pacific&#10;```&#10;&#10;I chose a completely random location. You can get the [full list of timezones](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones) or open your python shell (ever heard of [bpython](https://bpython-interpreter.org/)?) and type this code:&#10;&#10;```python&#10;from pytz import all_timezones&#10;for tz in all_timezones:&#10;      print(tz)&#10;```&#10;&#10;### Editor and OS&#10;&#10;I'm on linux, so **n** for me.&#10;&#10;```shell&#10;windows [n]:&#10;use_pycharm [n]: y&#10;```&#10;&#10;If you are using [pycharm](https://www.jetbrains.com/pycharm/), the cookiecutter will create `runserver`, `migrate` and more run configurations automatically for you, neat 😎.&#10;&#10;### Docker&#10;&#10;```shell&#10;use_docker [n]: n&#10;```&#10;&#10;Docker is an open source platform for developing, shipping, and running applications. Docker enables you to separate your applications from your infrastructure, so you can deliver software quickly. Enter **y** and the cookiecutter will automatically create docker and docker-compose files to help you run your project locally and even deploy it with less effort. It's a great start to help you deploy your project, but I think it is necessary to have a minimum of experience with docker to understand how to correctly use the generated files. If you want more information about docker, read [this](https://www.docker.com/).&#10;&#10;```shell&#10;Select postgresql_version:&#10;1 - 14&#10;2 - 13&#10;3 - 12&#10;4 - 11&#10;5 - 10&#10;Choose from 1, 2, 3, 4, 5 [1]:&#10;```&#10;&#10;Set the version of postgresql to use in the Dockerfile for production. This only matters if you enter *y* at the *use_docker* option. As I don't often use the docker and docker compose configuration provided by the cookiecutter (I create my own files), it doesn't really matter to me.&#10;&#10;### Cloud services&#10;&#10;```c&#10;Select cloud_provider:&#10;1 - AWS&#10;2 - GCP&#10;3 - None&#10;Choose from 1, 2, 3 [1]:&#10;```&#10;&#10;This is about static (HTML, CSS, static images like background images) and media files (file upload by you or your users like profile picture for example) storages. If you choose **AWS** (amazon web service) or **GCP** (google cloud provider), your project will be configured for these providers to handle static and media files in production. If you choose **None**, then media files will not work by default (you will have to set it up yourself) in production and static files will work only if you choose **y** on the option *use_whitenoise*.&#10;For a step-by-step guide on how to configure static and media files serving yourself using **AWS**, watch [this](https://www.youtube.com/watch?v=kt3ZtW9MXhw&amp;list=PL-osiE80TeTtoQCKZ03TU5fNfx2UY6U4p&amp;index=16).&#10;&#10;```c&#10;Select mail_service:&#10;1 - Mailgun&#10;2 - Amazon SES&#10;3 - Mailjet&#10;4 - Mandrill&#10;5 - Postmark&#10;6 - Sendgrid&#10;7 - SendinBlue&#10;8 - SparkPost&#10;9 - Other SMTP&#10;Choose from 1, 2, 3, 4, 5, 6, 7, 8, 9 [1]: 2&#10;```&#10;&#10;I usually go with [amazon SES](https://aws.amazon.com/ses/) because it is the easiest to set up for me, but do what you want based on your experience. For a simple setup based on [SMTP](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol) settings, choose **9**.&#10;&#10;### Async django&#10;&#10;```shell&#10;use_async [n]:&#10;```&#10;&#10;&gt; Indicates whether the project should use web sockets with Uvicorn + Gunicorn.&#10;&#10;This statement is from the [cookiecutter-django official documentation](https://cookiecutter-django.readthedocs.io/en/latest/project-generation-options.html).&#10;If you are not sure what it means, there is a high chance you don't need it, skip it.&#10;If you want to know more about websocket in django, read [this](https://dev.to/alexoleshkevich/websockets-in-django-3-1-532o).&#10;&#10;### Django rest framework&#10;&#10;```shell&#10;use_drf [n]:&#10;```&#10;&#10;In case you are building a json based API, then choose **y**.&#10;More info on Dango Rest framework [here](https://www.django-rest-framework.org/).  DRF is the go-to framework to build json-based APIs with django. What I call a json-based API here most people would call it a REST API, but [here's why](https://htmx.org/essays/how-did-rest-come-to-mean-the-opposite-of-rest/) they're wrong.&#10;&#10;### Frontend&#10;&#10;```shell&#10;Select frontend_pipeline:&#10;1 - None&#10;2 - Django Compressor&#10;3 - Gulp&#10;Choose from 1, 2, 3 [1]:&#10;```&#10;&#10;The tools suggested here are for minification, transpilation, etc of static assets (CSS, JS, etc). I don't use any of them, so my answer is always the default, **None**.&#10;If you want to know more about these tools, check out their official documentation:&#10;&#10;-  [Gulp](https://gulpjs.com/)&#10;-  [django-compressor](https://github.com/django-compressor/django-compressor)&#10;&#10;### Celery&#10;&#10;```shell&#10;use_celery [n]:&#10;```&#10;&#10;[Celery](https://github.com/celery/celery) is an open source asynchronous task queue or job queue which is based on distributed message passing. While it supports scheduling, its focus is on operations in real time. That was the wikipedia definition 😅.&#10;Celery is used to handle asynchronous tasks (background tasks) and scheduled tasks (things that should happen in the future).&#10;I don't use celery that much, I find it a bit too complex for most of my use cases.&#10;You can read my article on [[Handling background tasks in django]] to see how I handle this kind of stuff in my projects.&#10;&#10;### Local email server setup&#10;&#10;```shell&#10;use_mailhog [n]: y&#10;```&#10;&#10;[MailHog](https://github.com/mailhog/MailHog) is an email testing tool for developers. The [django console backend](https://docs.djangoproject.com/en/4.1/topics/email/#console-backend) is set up for local development if you choose **n** but mailhog gives you a nice graphical user interface (GUI) when you test your email delivery locally.&#10;&#10;### Sentry - production error tracking&#10;&#10;```shell&#10;use_sentry [n]: y&#10;```&#10;&#10;[Sentry](https://github.com/getsentry/sentry) is an error monitoring and tracking system. I recommend you always choose **y** if you know your app is going in production, it will avoid you the hassle of always switching your **DEBUG** environment variable value to see errors when they happened in production. It is very easy to set up, just follow the [official guide](https://docs.sentry.io/platforms/python/guides/django/) If you want to configure it manually. If you choose **y** the only thing you need is a **Sentry DSN** key that you can get by creating a django app on the official [web platform](https://sentry.io).&#10;&#10;### Whitenoise&#10;&#10;```shell&#10;use_whitenoise [n]: y&#10;```&#10;&#10;[Whitenoise](https://github.com/evansd/whitenoise) serves your static files in production and [locally](http://whitenoise.evans.io/en/stable/django.html#using-whitenoise-in-development) if you want it to.  I usually choose **y** because having the same setup for production and local development can help mitigate surprises on your production environment.&#10;&#10;### Heroku&#10;&#10;```shell&#10;use_heroku [n]: y&#10;```&#10;&#10;Heroku is a hosting platform for web applications. The cookiecutter will add the necessary requirements for your project to work on heroku, these requirements being:&#10;- A requirements.txt file with all your project production requirements&#10;- A [Procfile](https://devcenter.heroku.com/articles/procfile)&#10;If you are using a similar deployment method based on a procfile like [[Host your Django project on DigitalOcean using dokku|dokku]] type *y* if not then *n*.&#10;&#10;### Continuous Integration (CI)&#10;&#10;```shell&#10;Select ci_tool:&#10;1 - None&#10;2 - Travis&#10;3 - Gitlab&#10;4 - Github&#10;Choose from 1, 2, 3, 4 [1]:&#10;```&#10;&#10;Select an option other than the default if you are planning to set up a CI/CD pipeline for your project. More info on how to set up CI/CD for a django project [here](https://buddy.works/docs/quickstart/django).&#10;&#10;### Environment variables&#10;&#10;```shell&#10;keep_local_envs_in_vcs [y]:&#10;```&#10;&#10;If you typed **y** on the **use_docker** or **use_heroku** option, then your project will have a `.envs` folder with `.local` and `.production` subdirectories.&#10;If on the current option you type **n**, both folder will be kept out of your version control system (VCS), if you choose the default value your `.local will be tracked by your VCS.&#10;&#10;### Cookiecutter debug&#10;&#10;```shell&#10;debug [n]:&#10;```&#10;&#10;This option is only for Cookiecutter Django developers only, choose the default value.&#10;&#10;If all went well, you will get this message.&#10;&#10;```shell&#10; [SUCCESS]: Project initialized, keep up the good work!&#10;```&#10;&#10;## Structures of the project&#10;&#10;Let's take a quick look at the generated project. I use [tree](https://www.tecmint.com/linux-tree-command-examples/) to get a two-level tree view generated project.&#10;&#10;```shell&#10;cd ushopify&#10;tree -L 2&#10;```&#10;&#10;```shell&#10;├── CONTRIBUTORS.txt&#10;├── LICENSE&#10;├── README.md&#10;├── config&#10;│   ├── __init__.py&#10;│   ├── settings&#10;│   ├── urls.py&#10;│   └── wsgi.py&#10;├── docs&#10;│   ├── Makefile&#10;│   ├── __init__.py&#10;│   ├── conf.py&#10;│   ├── howto.rst&#10;│   ├── index.rst&#10;│   ├── make.bat&#10;│   ├── pycharm&#10;│   └── users.rst&#10;├── locale&#10;│   └── README.rst&#10;├── manage.py&#10;├── pytest.ini&#10;├── requirements&#10;│   ├── base.txt&#10;│   ├── local.txt&#10;│   └── production.txt&#10;├── setup.cfg&#10;├── ushopify&#10;│   ├── __init__.py&#10;│   ├── conftest.py&#10;│   ├── contrib&#10;│   ├── static&#10;│   ├── templates&#10;│   ├── users&#10;│   └── utils&#10;└── utility&#10;    ├── install_os_dependencies.sh&#10;    ├── install_python_dependencies.sh&#10;    ├── requirements-bionic.apt&#10;    ├── requirements-bullseye.apt&#10;    ├── requirements-buster.apt&#10;    ├── requirements-focal.apt&#10;    ├── requirements-jessie.apt&#10;    ├── requirements-stretch.apt&#10;    ├── requirements-trusty.apt&#10;    └── requirements-xenial.apt&#10;&#10;13 directories, 32 files&#10;```&#10;&#10;&#10;At the root of your project should have these directories:&#10;&#10;- `config`: store all your project settings and configurations. In the `settings` subdirectory, you have a `base.py` setting file for common settings, a `local.py` and a `production.py` file respectively for development and production specific settings. In the root of this directory, you have your classic `url.py` (your project level urls configurations) and your `wsgi.py` file.&#10;- `docs`: if you need to write a documentation for your project, it is configured to use [sphinx](https://www.sphinx-doc.org/en/master/index.html) documentation generator&#10;- `locale`: this folder is there to store [translations](https://docs.djangoproject.com/en/3.1/topics/i18n/translation/)&#10;- `requirements`: this folder contains all your project's requirements, the `base.txt` file contains all requirements common to your dev and prod environments, the `local.txt` file for your development environment and `production.txt` for your production environment.&#10;- `ushopify`: this folder contains all your templates and statics files, it also contains a `users` app created by the cookiecutter. This app use the excellent [allauth](https://github.com/pennersr/django-allauth) package to offers your project full user management system, login, logout, reset password, change password, change email, email verification and much more. The `users` app contains a `tests` directory with test files structured like this: `test_{module}.py`. This test structure is the one defined in the `ushopify/conftest.py` file. Follow it when writing your tests, or update the `conftest.py` file to match your needs. In this folder, you also have a `utils` subdirectory that contains a `context_processors.py` file. Read this short [article](https://dev.to/harveyhalwin/using-context-processor-in-django-to-create-dynamic-footer-45k4) for more information on context processors.&#10;- `Utility`: this folder contains some bash scripts that help you install system and project requirements, useful only if you are planning on deploying on a linux server and set up the server yourself.&#10;&#10;Beside those directories, you have the classic `manage.py` file to run your commands, a `Procfile` if you choose to deploy using Heroku, a `pytest.ini` file because the project is configured to use [pytest](https://docs.pytest.org/en/stable/) for testing.&#10;&#10;&#10;## Run your project&#10;&#10;Running your project works like for any other django project, you create a virtual environment, you install the requirements, create a database, then run your migrations.&#10;You can find detailed instructions [here](https://cookiecutter-django.readthedocs.io/en/latest/developing-locally.html).&#10;&#10;---&#10;I know it was a lot to digest and the project generated can seem very complex the first time, but you get used to it with time. If you feel like some of the generated defaults don't work for you, want to use [poetry](https://python-poetry.org/) instead of a virtualenv, don't like the exact folder structure, etc, I encourage you to [build your own cookiecutter](https://cookiecutter.readthedocs.io/en/stable/tutorials/tutorial2.html) or create a simpler version with the [django project template system](https://www.valentinog.com/blog/django-project/).&#10;If you have any comments, feel free to leave them in the comment section below and subscribe to keep up to date with my findings 😃.&#10;"><title>Bootstraping a production-ready django project</title><link href="https://oluwatobi.dev/blog/bootstraping-a-production-ready-django-project" rel="alternate"/><published>2022-10-30T16:00:00-05:00</published><id>https://oluwatobi.dev/blog/bootstraping-a-production-ready-django-project</id><summary type="html">If you have some experience with django and feel that the django django-admin startproject command is too light for you, then cookiecuter-django might be just what you are looking for.</summary></entry></feed>